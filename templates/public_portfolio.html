{% extends "layout.html" %}

{% block title %}{{ user.username }}'s Portfolio{% endblock %}

{% block content %}
<div class="container">
  <!-- Header -->
  <div class="profile-header" style="margin-bottom:16px; display:flex; align-items:center; gap:16px;">
    {% if user.profile_picture %}
    <img src="{{ url_for('static', filename='uploads/' + user.profile_picture) }}" alt="{{ user.username }}" style="width:90px; height:90px; border-radius:50%; object-fit:cover; border:3px solid var(--accent-color); flex-shrink:0;" />
    {% else %}
    <div style="width:90px; height:90px; border-radius:50%; background:linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%); display:flex; align-items:center; justify-content:center; color:white; font-size:40px; font-weight:bold; flex-shrink:0;">
      {{ (user.username or 'U')[:1].upper() }}
    </div>
    {% endif %}
    <div>
      <h1 style="margin:0 0 4px 0;">{{ user.username }}'s Portfolio</h1>
      <p class="text-muted" style="margin:0;">{{ user.course or 'Student' }}</p>
      {% if user.bio %}
      <p style="max-width:600px; margin:6px 0 0 0; color:var(--muted); font-size:14px;">{{ user.bio }}</p>
      {% endif %}
    </div>
  </div>

  <!-- Contact & Professional Information Section -->
  <div class="card" style="margin-bottom:24px; background:#f1f5f9; border:1px solid #e2e8f0;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px;">
      {% if user.phone or user.address or user.email %}
      <div>
        <h4 style="margin: 0 0 12px 0; color: var(--primary-color); font-weight:700;">ðŸ“ž Contact</h4>
        {% if user.phone %}
        <p style="margin: 0 0 6px 0; font-size:14px;"><strong>Phone:</strong> {{ user.phone }}</p>
        {% endif %}
        {% if user.email %}
        <p style="margin: 0 0 6px 0; font-size:14px;"><strong>Email:</strong> <a href="mailto:{{ user.email }}" style="color: var(--primary-color); text-decoration: underline;">{{ user.email }}</a></p>
        {% endif %}
        {% if user.address %}
        <p style="margin: 0; font-size:14px; color:var(--muted);"><strong>Address:</strong><br>{{ user.address }}</p>
        {% endif %}
      </div>
      {% endif %}

      {% if user.education %}
      <div>
        <h4 style="margin: 0 0 12px 0; color: var(--primary-color); font-weight:700;">ðŸŽ“ Education</h4>
        <p style="margin: 0; color: var(--muted); white-space: pre-line; font-size:14px; line-height:1.5;">{{ user.education }}</p>
      </div>
      {% endif %}
    </div>

    {% if user.skills %}
    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
      <h4 style="margin: 0 0 10px 0; color: var(--primary-color); font-weight:700;">ðŸ’¡ Skills</h4>
      <div style="display: flex; flex-wrap: wrap; gap: 8px;">
        {% for skill in user.skills.split('\n') if skill.strip() %}
        <span style="background: #f1f5f9; color: var(--primary-color); padding: 6px 12px; border-radius: 16px; font-size: 13px; font-weight: 600;">{{ skill.strip() }}</span>
        {% endfor %}
        {% if '\n' not in user.skills %}
          {% for skill in user.skills.split(',') if skill.strip() %}
          <span style="background: #f1f5f9; color: var(--primary-color); padding: 6px 12px; border-radius: 16px; font-size: 13px; font-weight: 600;">{{ skill.strip() }}</span>
          {% endfor %}
        {% endif %}
      </div>
    </div>
    {% endif %}

    {% if user.experience %}
    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
      <h4 style="margin: 0 0 10px 0; color: var(--primary-color); font-weight:700;">ðŸ’¼ Experience</h4>
      <p style="margin: 0; color: var(--muted); white-space: pre-line; line-height: 1.5; font-size:14px;">{{ user.experience }}</p>
    </div>
    {% endif %}
  </div>

  {# Removed owner-only Add New Project form to keep public portfolio view read-only #}

  <h3 style="margin-bottom:12px; color:var(--primary-color);">Projects</h3>
  {% if projects %}
  <div class="projects-grid">
    {% for p in projects %}
    <article class="project-card">
      <div class="project-card-image">
        {% if p.image_file %}
        <img src="{{ url_for('static', filename='uploads/' + p.image_file) }}" alt="{{ p.title }}" style="width:100%; height:100%; object-fit:cover;" />
        {% else %}
        <div class="no-image">No Image</div>
        {% endif %}
      </div>
      <div class="project-card-content">
        <h4 class="project-card-title">{{ p.title }}</h4>
        <p class="project-card-description">{{ (p.description or '')[:140] }}{% if p.description and p.description|length > 140 %}...{% endif %}</p>
        <p class="text-muted small">ðŸ“… {{ p.date_posted.strftime('%b %d, %Y') }}</p>
      </div>
      {% if current_user.is_authenticated and current_user.id == user.id %}
      <div class="project-card-footer">
        <a href="{{ url_for('edit_project', id=p.id) }}">Edit</a>
        <a href="{{ url_for('delete_project', id=p.id) }}" onclick="return confirm('Delete this project?')">Delete</a>
      </div>
      {% endif %}
    </article>
    {% endfor %}
  </div>
  {% else %}
  <div class="card text-center">
    <p class="text-muted">No projects yet.</p>
    {% if current_user.is_authenticated and current_user.id == user.id %}
    <p style="margin-top:10px;"><a href="{{ url_for('projects') }}" class="text-primary">Create your first project â†’</a></p>
    {% endif %}
  </div>
  {% endif %}
</div>

{% endblock %}
